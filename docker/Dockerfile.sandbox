# Dockerfile.sandbox
#
# Extends the official OpenClaw sandbox base image with Python 3.11+ and
# CareerClaw installed. Used ONLY for local testing â€” not part of the
# ClawHub publication flow.
#
# Build:
#   docker build -f docker/Dockerfile.sandbox -t openclaw-sandbox:careerclaw .
#
# The resulting image is referenced as "openclaw-sandbox:careerclaw" in
# docker/openclaw.yml and must be built before starting the gateway.

FROM openclaw:local

# Drop back to root to install CareerClaw, then restore non-root user.
USER root

# Install CareerClaw from the workspace mount (read-only source).
# The workspace is mounted at /workspace at runtime; we install it here
# at build time by copying only what pip needs (pyproject.toml + package).
# Using --break-system-packages because we are in a throwaway container.
COPY careerclaw/ /tmp/careerclaw-src/careerclaw/
COPY pyproject.toml /tmp/careerclaw-src/
RUN pip install --upgrade --break-system-packages --no-cache-dir pip && \
    pip install --break-system-packages --no-cache-dir /tmp/careerclaw-src \
        anthropic \
        openai && \
    rm -rf /tmp/careerclaw-src

# Ensure runtime user is non-root (OpenClaw expects UID/GID 1000)
# Use numeric IDs to avoid /etc/passwd username requirement.
RUN mkdir -p /workspace && chown -R 1000:1000 /workspace

USER 1000:1000
WORKDIR /workspace